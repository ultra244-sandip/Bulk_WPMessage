<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>WhatsApp Bulk Link Generator</title>
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
  <meta name="theme-color" content="#25D366">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

  <!-- iOS support -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='icons/icon-192.png') }}">
</head>
<body>
  <header>WhatsApp Bulk Link Generator</header>
  <div class="container">
    {% if error %}
      <div class="error">{{ error }}</div>
    {% endif %}

    <form method="post" enctype="multipart/form-data">
      <label>Message Template (use {name})</label>
      <input type="text" name="template" placeholder="Hi {name}, your appointment is at 3pm" required>

      <label>Upload CSV (Name & Phone)</label>
      <input type="file" name="csvfile" accept=".csv" required>

      <button type="submit">Generate Links</button>
    </form>

    {% if links %}
      <ul>
        {% for item in links %}
          {% if item.url %}
            <li>
              <span>{{ item.name }}</span>
              <a href="{{ item.url }}" target="_blank">Open Chat</a>
            </li>
          {% else %}
            <li class="error">‚ùå {{ item.name }}: invalid {{ item.phone }}</li>
          {% endif %}
        {% endfor %}
      </ul>
    {% endif %}
  </div>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/static/sw.js')
        .catch(err => console.warn("SW registration failed:", err));
    }
  </script>
</body>
</html>
